#!/usr/bin/env bash
sed -e 's/___\{10,\}[^_]*microsoft teams meeting.*to join the meeting<\([^>]*\).*___\{10,\}/\n────────────────────────────────────────────────────────────────────────\n\nTeams Meeting ~~\n\nMeeting URL:\n\1\n\n────────────────────────────────────────────────────────────────────────/I' \
    -e 's/^\(To\|CC\): \([^<]*[^>]\)$/\1:<\2>/g' \
    -e '/^To:/{;:l N;/!END!/b; s/\(\n\|  *\|\t\t*\)/ /g; bl}' \
    -e '/^To:/,/>$/ s/\([^>]*>,\?\)/\1\n/g' \
    -e 's/^ \(CC:\)\(.*$\)/\1\n\2/' \
    -e 's/^\(To:\)\(.*$\)/\1\2/' \
    -e 's/^!END!$//' \
    -e '/!REMOVE_ME!/d' \
    -e '/\[-- Type: text.* --\]/d' \
    -e '/\[-- Autoview.* --\]/d' \
    -e '/\[-- Type.* --\]/d' \
    -e '/\[-- .*unsupported.* --\]/d' \
    -e '/\[-- Attachment #[0-9] --\]/d' \
    -e 's/Attachment #[0-9]: //g' \
    -e '/./,/^$/!d' \
    -e 's/\([A-Z]*\), *\([A-Za-z]*\)\("?\)/\2 \L\u\1\E\3/g' \
    -e 's/^/    /'
